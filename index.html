<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SAP Business One Freelancer · SAP FSM CRD — Add‑ons, Reporting, Integrations</title>
  <meta name="description" content="Freelance SAP Business One & SAP FSM developer: SAP B1 add‑ons (SDK, UI/DI API), Company integrations/data exchange, Crystal Reports, coresuite Country Package, Boyum, SQL for B1, FSM CRD dashboards, FSM checklist XML → B1 mapping & mass invoicing. EN/DE/AR" />
  <meta name="robots" content="index, follow" />
  <meta name="keywords" content="SAP Business One Freelancer, SAP B1 SDK, DI API, UI API, Company integrations, data exchange, CSV XML, SFTP, Crystal Reports, coresuite Country Package, Boyum, SAP FSM, CRD, SQL for SAP B1, FSM checklist XML, mass invoicing, batch processing" />
  <meta name="theme-color" content="#0ea5e9" />

  <!-- Open Graph / Twitter SEO -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SAP Business One Freelancer · SAP FSM CRD — Add‑ons, Reporting, Integrations" />
  <meta property="og:description" content="SAP B1 add‑ons (SDK), company integrations, Crystal/coresuite/Boyum, SQL, and SAP FSM CRD dashboards. EN/DE/AR." />
  <meta property="og:site_name" content="B1 • FSM — Freelance" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:locale:alternate" content="de_DE" />
  <meta property="og:locale:alternate" content="ar_AR" />
  <meta property="og:image" content="og-image.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="og-image.png" />
  <link id="canonical" rel="canonical" href="" />
  <link rel="alternate" hreflang="en" href="?lang=en" />
  <link rel="alternate" hreflang="de" href="?lang=de" />
  <link rel="alternate" hreflang="ar" href="?lang=ar" />
  <link rel="alternate" hreflang="x-default" href="?lang=en" />
  <link rel="alternate" hreflang="zh-CN" href="?lang=zh-CN" />

  <link rel="icon" href="favicon.svg" type="image/svg+xml" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ProfessionalService",
    "name": "B1 • FSM — Freelance",
    "areaServed": "DE",
    "availableLanguage": ["en", "de", "ar", "zh-CN"],
    "sameAs": [
      "https://www.freelancermap.de/profil/mhd-tarek-fatal",
      "https://www.linkedin.com/in/tarek-fatal-3a1000111/"
    ],
    "contactPoint": [{
      "@type": "ContactPoint",
      "contactType": "customer support",
      "email": "SAPB1.Tarek.Fatal@outlook.com"
    }],
    "serviceType": [
      "SAP Business One Add-ons (SDK)",
      "Company integrations / data exchange",
      "Crystal Reports / coresuite / Boyum",
      "coresuite Country Package",
      "SQL for SAP B1",
      "SAP FSM Cloud Reporting & Dashboards (CRD)",
      "FSM checklist XML → SAP B1 & invoicing (bulk)",
      "Training / Workshops"
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {"@type": "Question","name": "Do you handle company/system integrations for SAP B1?","acceptedAnswer": {"@type": "Answer","text": "Yes. CSV/XML imports/exports, SFTP jobs, mapping tables to UDFs/tables, and safe batch processing with logging and retries."}},
      {"@type": "Question","name": "Do you work with the coresuite Country Package?","acceptedAnswer": {"@type": "Answer","text": "Yes. Layouts, print profiles, script adjustments, and report customization for coresuite Country Package."}},
      {"@type": "Question","name": "Can you map FSM checklist XML into B1 and mass‑invoice?","acceptedAnswer": {"@type": "Answer","text": "Yes. I parse checklist XML into UDFs/tables, map values to documents, and generate invoices with batch processing."}},
      {"@type": "Question","name": "What SAP B1 work do you cover?","acceptedAnswer": {"@type": "Answer","text": "Add-ons with SDK (UI/DI API), Crystal Reports, coresuite/Boyum printouts, SQL queries and data models."}},
      {"@type": "Question","name": "Do you provide training?","acceptedAnswer": {"@type": "Answer","text": "Yes. User training and short workshops for SAP B1 basics, Crystal Reports, and FSM CRD dashboards."}},
      {"@type": "Question","name": "Do you work remotely and in which languages?","acceptedAnswer": {"@type": "Answer","text": "Yes, remote across Germany/EU. I work in English, German, and Arabic."}}
    ]
  }
  </script>

  <style>
    :root{ 
      --sap-blue:#0a6ed1; --sap-gold:#ffcc00; --sap-dark:#071a2e;
      --bg:#071a2e; --panel:#0b2745; --text:#f4f8ff; --muted:#b8c7db; --brand:var(--sap-blue);
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.25); 
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Arial,sans-serif; color:var(--text); background:var(--bg);
      background-image: radial-gradient(1200px 600px at 10% -10%, rgba(10,110,209,.22), transparent 60%),
                        radial-gradient(900px 500px at 110% 10%, rgba(255,204,0,.18), transparent 55%);
      animation:bgFloat 16s linear infinite;
    }
    @keyframes bgFloat{0%{background-position:0 0,0 0}100%{background-position:300px 0,-300px 0}}
    body[dir="rtl"]{font-family:Cairo, Inter, system-ui, Segoe UI, Arial, sans-serif}
    html[lang="zh-CN"] body{font-family:system-ui,-apple-system,"PingFang SC","Microsoft YaHei","Noto Sans SC",Arial,sans-serif}
    a{color:var(--brand); text-decoration:none; cursor:pointer}

    .wrap{max-width:1024px; margin:0 auto; padding:0 18px}
    header{position:sticky; top:0; z-index:10; backdrop-filter:blur(8px); background:rgba(7,26,46,.85); border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex; align-items:center; justify-content:space-between; height:72px}
    .brand{display:flex; align-items:center; gap:12px; font-weight:700}
    .brand-logo{height:28px; width:auto; display:inline-block; filter:drop-shadow(0 2px 6px rgba(0,0,0,.35))}
    .logo-fallback{display:none; padding:6px 10px; border-radius:10px; background:linear-gradient(135deg, rgba(10,110,209,.25), rgba(10,110,209,.45)); border:1px solid rgba(255,255,255,.12)}

    nav{display:flex; align-items:center; gap:12px}
    .btn{display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:12px; font-weight:700; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.05); transition:transform .12s ease, box-shadow .12s ease, background .2s ease}
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(135deg, var(--sap-blue), #2d8ff0); color:#03121f}
    .btn.primary:hover{box-shadow:0 0 0 .15rem rgba(10,110,209,.35)}

    .lang{display:flex; gap:6px; align-items:center}
    .lang button{all:unset; padding:6px 10px; border:1px solid rgba(255,255,255,.12); border-radius:999px; cursor:pointer}
    .lang button.active{background:rgba(255,255,255,.12)}

    .hero{padding:72px 0 56px}
    h1{font-size:clamp(28px,5vw,44px); line-height:1.15; margin:.4rem 0 1rem}
    .lead{color:var(--muted); font-size:clamp(16px,2vw,18px)}
    .cta{display:flex; gap:10px; flex-wrap:wrap; margin-top:18px}

    .brand-chips{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-weight:600; background:rgba(10,110,209,.18); border:1px solid rgba(10,110,209,.35)}
    .chip.gold{background:rgba(255,204,0,.18); border-color:rgba(255,204,0,.4); color:#fff}

    section{padding:48px 0}
    .title{font-size:22px; margin:0 0 16px}

    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:14px}
    .card{grid-column:span 6; background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); opacity:0; transform:translateY(12px); transition:opacity .5s ease, transform .5s ease}
    .card.in{opacity:1; transform:none}
    .card h3{margin:.2rem 0 .4rem}
    .muted{color:var(--muted)}

    footer{border-top:1px solid rgba(255,255,255,.08); padding:26px 0 40px; color:#c6d3e6}
    .social{display:flex; gap:14px}

    @media (max-width:780px){ .grid .card{grid-column:span 12} }
  </style>
  <style>
    /* Mobile sticky CTA */
    .sticky-cta{position:fixed; right:12px; bottom:12px; z-index:20}
    .sticky-cta .btn{box-shadow:0 10px 20px rgba(10,110,209,.35)}
    @media(min-width:781px){.sticky-cta{display:none}}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">
        <!-- Optional SAP B1 logo: place a file named sap-b1-logo.png next to index.html -->
        <img src="sap-b1-logo.png" alt="SAP Business One" class="brand-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-flex'">
        <span class="logo-fallback">B1 • FSM</span>
      </div>
      <nav>
        <div class="lang" aria-label="Language switcher">
          <button data-lang="en" class="active">EN</button>
          <button data-lang="de">DE</button>
          <button data-lang="ar">AR</button>
          <button data-lang="zh-CN">ZH</button>
        </div>
        <a class="btn" href="#services" data-i18n="nav_services">Services</a>
        <a class="btn" href="#process" data-i18n="nav_process">Process</a>
        <a class="btn" href="#faq" data-i18n="nav_faq">FAQ</a>
        <a class="btn" href="#contact" data-i18n="nav_contact">Contact</a>
        <a class="btn primary" href="mailto:SAPB1.Tarek.Fatal@outlook.com?subject=SAP%20B1%20%2F%20FSM%20Inquiry" rel="external noopener"><i class="fa-solid fa-envelope"></i><span data-i18n="btn_email">Email</span></a>
        <a class="btn" href="https://www.freelancermap.de/profil/mhd-tarek-fatal" target="_blank" rel="noopener noreferrer">freelancermap</a>
        <a class="btn" href="https://www.linkedin.com/in/tarek-fatal-3a1000111/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="wrap">
        <p class="muted" data-i18n="tagline">SAP Business One · SAP Field Service Management</p>
        <h1 data-i18n="headline">SAP B1 + FSM Freelancer</h1>
        <p class="lead" data-i18n="lead">Add‑ons (SDK) in C#/.NET with UI API & DI API · <strong>Company integrations / data exchange</strong> · SQL queries · Crystal Reports · coresuite & Boyum · FSM Cloud Reporting & Dashboards (CRD).</p>
        <div class="brand-chips">
          <span class="chip"><i class="fa-solid fa-square"></i> SAP Business One</span>
          <span class="chip gold"><i class="fa-solid fa-chart-column"></i> Crystal / coresuite / Boyum</span>
          <span class="chip"><i class="fa-solid fa-mobile-screen"></i> SAP FSM · CRD</span>
        </div>
        <div class="cta">
          <a class="btn primary" href="mailto:SAPB1.Tarek.Fatal@outlook.com?subject=SAP%20B1%20%2F%20FSM%20Inquiry" rel="external noopener"><i class="fa-solid fa-paper-plane"></i><span data-i18n="btn_contact">Email me</span></a>
          <a class="btn" href="https://www.freelancermap.de/profil/mhd-tarek-fatal" target="_blank" rel="noopener noreferrer"><i class="fa-solid fa-id-card"></i>freelancermap</a>
          <a class="btn" href="https://www.linkedin.com/in/tarek-fatal-3a1000111/" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-linkedin"></i>LinkedIn</a>
        </div>
      </div>
    </section>

    <section id="services">
      <div class="wrap">
        <h2 class="title" data-i18n="services_title">Services</h2>
        <div class="grid">
          <article class="card">
            <h3><i class="fa-solid fa-code"></i> <span data-i18n="svc1_title">Add‑ons (SDK)</span></h3>
            <p class="muted" data-i18n="svc1_desc">C#/.NET with UI API & DI API · clean UX, validations, background jobs, safe COM handling.</p>
          </article>
          <article class="card">
            <h3><i class="fa-solid fa-arrows-rotate"></i> <span data-i18n="svc2a_title">Company Integrations</span></h3>
            <p class="muted" data-i18n="svc2a_desc">CSV/XML imports & exports, SFTP jobs, mapping to UDFs/tables, and safe batch processing with logs/retries.</p>
          </article>
          <article class="card">
            <h3><i class="fa-solid fa-chart-line"></i> <span data-i18n="svc2_title">Reporting</span></h3>
            <p class="muted" data-i18n="svc2_desc">Crystal Reports for SAP Business One · coresuite reports · Boyum printouts.</p>
          </article>
          <article class="card">
            <h3><i class="fa-solid fa-database"></i> <span data-i18n="svc3_title">SQL</span></h3>
            <p class="muted" data-i18n="svc3_desc">Queries, views and performance‑friendly data models for B1 documents.</p>
          </article>
          <article class="card">
            <h3><i class="fa-solid fa-gauge-high"></i> <span data-i18n="svc4_title">FSM (CRD)</span></h3>
            <p class="muted" data-i18n="svc4_desc">SAP FSM Cloud Reporting & Dashboards (CRD) and checklist configuration.</p>
          </article>
          <article class="card">
            <h3><i class="fa-solid fa-headset"></i> <span data-i18n="svc5_title">Support</span></h3>
            <p class="muted" data-i18n="svc5_desc">1st & 2nd level support for SAP B1 users · troubleshooting and documentation.</p>
          </article>
          <article class="card">
            <h3><i class="fa-solid fa-chalkboard-user"></i> <span data-i18n="svc6_title">Training / Workshops</span></h3>
            <p class="muted" data-i18n="svc6_desc">User training for SAP B1 basics, Crystal Reports usage, and FSM CRD dashboards (EN/DE/AR).</p>
          </article>
          <article class="card">
            <h3><i class="fa-solid fa-globe"></i> <span data-i18n="svc7_title">coresuite Country Package</span></h3>
            <p class="muted" data-i18n="svc7_desc">Layouts & print profiles, script tweaks, and report customization for coresuite Country Package.</p>
          </article>
          <article class="card">
            <h3><i class="fa-solid fa-file-code"></i> <span data-i18n="svc8_title">FSM Checklist XML → B1 & Invoicing</span></h3>
            <p class="muted" data-i18n="svc8_desc">Parse checklist XML to UDFs/tables, map values into documents, and generate invoices — supports mass/batch processing.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- Process -->
    <section id="process">
      <div class="wrap">
        <h2 class="title" data-i18n="process_title">Process</h2>
        <div class="grid">
          <article class="card"><h3 data-i18n="p1_title">1) Discover & Scope</h3><p class="muted" data-i18n="p1_desc">Short call & sample files; define target docs/UDFs, volume, and timeline.</p></article>
          <article class="card"><h3 data-i18n="p2_title">2) Map & Design</h3><p class="muted" data-i18n="p2_desc">Field mapping, validation rules, and staging tables/views for safe loads.</p></article>
          <article class="card"><h3 data-i18n="p3_title">3) Build & Test</h3><p class="muted" data-i18n="p3_desc">Implement SDK/queries/reports; run test batches with logs and rollback options.</p></article>
          <article class="card"><h3 data-i18n="p4_title">4) Deploy & Monitor</h3><p class="muted" data-i18n="p4_desc">Schedule batch jobs (SFTP/CSV/XML), handover docs, and support.</p></article>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq">
      <div class="wrap">
        <h2 class="title" data-i18n="faq_title">FAQ</h2>
        <div class="grid">
          <article class="card">
            <details open>
              <summary><strong data-i18n="faq_q_int">Do you handle company/system integrations for SAP B1?</strong></summary>
              <p class="muted" data-i18n="faq_a_int">Yes. CSV/XML imports/exports, SFTP jobs, mapping to UDFs/tables, and safe batch processing with logging and retries.</p>
            </details>
          </article>
          <article class="card">
            <details>
              <summary><strong data-i18n="faq_q4">Do you work with the coresuite Country Package?</strong></summary>
              <p class="muted" data-i18n="faq_a4">Yes. Layouts, print profiles, script adjustments, and report customization for coresuite Country Package.</p>
            </details>
          </article>
          <article class="card">
            <details>
              <summary><strong data-i18n="faq_q5">Can you map FSM checklist XML into B1 and mass‑invoice?</strong></summary>
              <p class="muted" data-i18n="faq_a5">Yes. I parse checklist XML into UDFs/tables, map values to documents, and generate invoices with batch processing.</p>
            </details>
          </article>
        </div>
      </div>
    </section>

    <section id="contact">
      <div class="wrap">
        <h2 class="title" data-i18n="contact_title">Contact</h2>
        <div class="cta">
          <a class="btn primary" href="mailto:SAPB1.Tarek.Fatal@outlook.com?subject=SAP%20B1%20%2F%20FSM%20Inquiry" rel="external noopener"><i class="fa-solid fa-envelope"></i><span data-i18n="btn_email">Email</span></a>
          <a class="btn" href="https://www.freelancermap.de/profil/mhd-tarek-fatal" target="_blank" rel="noopener noreferrer"><i class="fa-solid fa-id-card"></i>freelancermap</a>
          <a class="btn" href="https://www.linkedin.com/in/tarek-fatal-3a1000111/" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-linkedin"></i>LinkedIn</a>
        </div>
        <p class="muted" style="margin-top:10px" data-i18n="disclaimer">Independent — not affiliated with SAP SE.</p>
      </div>
    </section>

    <div class="sticky-cta">
      <a class="btn primary" href="mailto:SAPB1.Tarek.Fatal@outlook.com?subject=SAP%20B1%20%2F%20FSM%20Inquiry"><i class="fa-solid fa-paper-plane"></i><span data-i18n="btn_contact">Email me</span></a>
    </div>
  </main>

  <footer>
    <div class="wrap" style="display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap">
      <p>© <span id="year"></span> B1 • FSM — Freelance</p>
      <div class="social">
        <a href="https://www.freelancermap.de/profil/mhd-tarek-fatal" target="_blank" rel="noopener noreferrer" aria-label="freelancermap"><i class="fa-solid fa-id-card"></i></a>
        <a href="https://www.linkedin.com/in/tarek-fatal-3a1000111/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn"><i class="fa-brands fa-linkedin"></i></a>
      </div>
    </div>
  </footer>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Canonical without query/hash
    const canon = location.origin + location.pathname;
    const $can = document.getElementById('canonical');
    if($can) $can.href = canon;

    // Reveal-on-scroll for cards
    const io = new IntersectionObserver(entries=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target); } });
    },{threshold:.12});
    document.querySelectorAll('.card').forEach(el=> io.observe(el));

    // i18n dictionary
    const t = {
      en: { /* unchanged for brevity */ },
      de: { /* unchanged for brevity */ },
      ar: { /* unchanged for brevity */ },
      "zh-CN": {
        nav_services:'服务', nav_process:'流程', nav_faq:'常见问题', nav_contact:'联系',
        tagline:'SAP Business One · SAP 现场服务管理',
        headline:'SAP B1 + FSM 自由职业者',
        lead:'使用 C#/.NET（UI API & DI API）的插件（SDK）· 公司系统集成/数据交换 · SQL 查询 · Crystal 报表 · coresuite & Boyum · SAP FSM 云端报表与看板（CRD）。',
        btn_contact:'发送邮件', btn_email:'邮件',
        services_title:'服务',
        svc1_title:'插件（SDK）',
        svc1_desc:'C#/.NET + UI/DI API · 规范界面、校验、后台任务与安全 COM 处理。',
        svc2a_title:'系统集成',
        svc2a_desc:'CSV/XML 导入导出、SFTP 任务、映射至 UDF/表，以及带日志/重试的安全批处理。',
        svc2_title:'报表',
        svc2_desc:'SAP B1 的 Crystal 报表 · coresuite 报表 · Boyum 打印。',
        svc3_title:'SQL',
        svc3_desc:'用于 B1 单据的查询、视图与高性能数据模型。',
        svc4_title:'FSM（CRD）',
        svc4_desc:'SAP FSM 云报表与看板（CRD）以及检查清单配置。',
        svc5_title:'支持',
        svc5_desc:'SAP B1 一线/二线支持 · 故障排查与文档。',
        svc6_title:'培训 / 工作坊',
        svc6_desc:'SAP B1 基础、Crystal 报表与 FSM‑CRD 看板的用户培训（沟通语言：EN/DE/AR）。',
        svc7_title:'coresuite 国家包',
        svc7_desc:'国家包布局与打印配置、脚本调整以及报表定制。',
        svc8_title:'FSM 检查清单 XML → B1 & 开票',
        svc8_desc:'解析检查清单 XML 到 UDF/表，映射到单据，并批量生成发票。',
        process_title:'流程',
        p1_title:'1) 需求沟通', p1_desc:'简短通话与样例文件；确定目标单据/UDF、数据量与时间表。',
        p2_title:'2) 映射与设计', p2_desc:'字段映射、校验规则，以及用于安全装载的暂存表/视图。',
        p3_title:'3) 开发与测试', p3_desc:'实现 SDK/查询/报表；运行测试批次并记录日志，可回滚。',
        p4_title:'4) 上线与监控', p4_desc:'计划批处理任务（SFTP/CSV/XML）、交付文档并提供支持。',
        faq_title:'常见问题',
        faq_q_int:'是否处理 SAP B1 的系统/公司集成？',
        faq_a_int:'是的。支持 CSV/XML 导入导出、SFTP 定时任务、映射到 UDF/表，以及带日志和重试的安全批处理。',
        faq_q4:'是否使用 coresuite 国家包？',
        faq_a4:'是的。提供布局、打印配置、脚本调整与报表定制。',
        faq_q5:'能否将 FSM 检查清单 XML 映射到 B1 并批量开票？',
        faq_a5:'可以。将 XML 解析到 UDF/表，映射到单据，并通过批处理生成发票。',
        contact_title:'联系', disclaimer:'独立个人，非 SAP SE 旗下。'
      }
    };

    function applyLang(code){
      const normalized = code.toLowerCase().startsWith('zh') ? 'zh-CN' : code;
      const dict = t[normalized] || t.en;
      document.documentElement.lang = normalized;
      document.body.setAttribute('dir', normalized === 'ar' ? 'rtl' : 'ltr');
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(dict[key]) el.textContent = dict[key];
      });
      document.querySelectorAll('.lang button').forEach(b=> b.classList.toggle('active', b.dataset.lang===normalized));
      localStorage.setItem('lang', normalized);
      // update hreflang hrefs to reflect chosen lang
      document.querySelectorAll('link[rel="alternate"]').forEach(l=>{
        if(l.hreflang && ['en','de','ar','zh-CN','x-default'].includes(l.hreflang)){
          const lang = l.hreflang==='x-default' ? 'en' : l.hreflang;
          l.href = canon + '?lang=' + lang;
        }
      });
    }

    const raw = (navigator.language || 'en');
    const initial = raw.toLowerCase().startsWith('zh') ? 'zh-CN' : raw.slice(0,2);
    applyLang(['en','de','ar','zh-CN'].includes(initial) ? initial : 'en');
    document.querySelectorAll('.lang button').forEach(btn=> btn.addEventListener('click', ()=> applyLang(btn.dataset.lang)));
  </script>
</body>
</html>
